# 학원 관리 프로그램 계획서 (계획서.md)

작성일: 2025-12-18 (Asia/Seoul)

---

## 0. 목적과 범위

### 목표
- 학원 운영 핵심 업무(학생/반/출결/수납/일정)를 **한 화면 흐름으로 관리**
- 알림 자동화(미납/결석/상담/일정변경)로 **반복 업무 최소화**
- 성적/학습/리포트로 **학부모 신뢰 + 운영 의사결정 지원**
- 장기적으로 학부모 포털/CRM/교재 관리까지 확장 가능한 구조

### 포함 기능(현재 계획)
- 📱 QR 출석 체크: QR 생성 + 스캔 화면
- 📊 Excel 내보내기: 학생/출결/수납 데이터 다운로드
- 📈 대시보드 차트: 출석률/매출 시각화
- 📅 시간표/캘린더: 수업 일정 보기 + 보강/휴원/특강 관리
- 💬 알림 발송: SMS/알림 보내기 화면 + 자동 트리거
- 🔔 알림/노티피케이션(자동화): 미납/결석/상담 리마인더/일정변경
- 📊 성적/학습 관리: 시험 성적 기록/추이/성적표/PDF/목표
- 📱 학부모 포털: 출결/성적/수납 조회 + (선택)온라인 결제 + (선택)메시지
- 📈 고급 리포트: 경영 리포트/이탈률/강사 통계/수익성
- 📚 교재/교재비: 재고/구매/청구 자동화
- 🎯 마케팅/CRM: 캠페인/추천인/재등록/대기자 연락
- 💬 커뮤니케이션: 수업 피드백/주간·월간 보고서/(선택)1:1 채팅

---

## 1. 기술 스택

### 백엔드
- Python
- Django (권장: 4.2 LTS 계열)
- PostgreSQL

### 프론트엔드
- Django Template + Bootstrap 5 (다크모드 포함 가능)
- 차트: Chart.js(권장)

### 인프라/운영
- Docker / Docker Compose
- Git (원격 저장소: GitHub 등)
- (권장) 비동기 작업: Celery + Redis
- (선택) 실시간/채팅: Django Channels + Redis
- (선택) PDF 출력: WeasyPrint 또는 wkhtmltopdf

---

## 2. 아키텍처 개요

### 핵심 원칙
- 앱(모듈) 단위 분리 → 기능 확장/유지보수 용이
- “업무 이벤트” 중심 설계(출결 완료, 미납 발생, 일정 변경 등) → 알림/리포트 자동화에 유리
- 개인정보/권한(원장/강사/직원/학부모) 엄격 분리

### 앱(모듈) 구성안
- accounts: 계정/권한/로그인
- students: 학생/보호자/반/상담
- attendance: 출결/QR 출석
- billing: 수납/미납/결제/청구서
- schedule: 시간표/캘린더/보강/휴원/특강
- notifications: 알림 템플릿/발송/로그/예약
- academics: 시험/성적/목표/성적표(PDF)
- parent_portal: 학부모 전용 화면/API
- reports: 대시보드/경영 리포트/통계
- materials: 교재/재고/교재비 청구
- crm: 캠페인/추천인/대기자/재등록
- communication: 피드백/주간·월간 보고/(선택)채팅

---

## 3. 사용자 역할/권한 (RBAC)

### 역할
- 원장(Admin): 전체 관리/설정/모든 리포트 열람
- 직원(Staff): 학생/출결/수납/일정 업무 처리
- 강사(Teacher): 담당 반/학생 출결/피드백/성적 입력(권한 제한)
- 학부모(Parent): 연결된 자녀 정보(출결/성적/수납) 조회, (선택)메시지, (선택)결제

### 권한 원칙
- 학부모는 “본인 자녀” 데이터만 접근
- 강사는 “담당 반/학생” 범위로 제한
- 모든 데이터 변경은 변경자/변경시간 로깅(감사 로그 권장)

---

## 4. 데이터 모델 초안 (핵심 테이블)

> 실제 구현 시 Django 모델로 생성하며, 인덱스/제약조건을 함께 정의한다.

### 4.1 students
- Student(id, name, birth_date, phone, school, grade, status, memo, created_at)
- Parent(id, name, phone, email, user(FK accounts))
- StudentParent(student_id, parent_id, relation, is_primary)
- ClassGroup(id, name, level, teacher_id, schedule_rule, capacity, status)
- CounselingLog(id, student_id, date, title, content, next_action, created_by)

### 4.2 attendance
- AttendanceSession(id, class_id, date, start_time, end_time, status)
- AttendanceRecord(id, session_id, student_id, status(PRESENT/ABSENT/LATE), check_in_at, note)
- QRAttendanceToken(id, session_id, token, expires_at, created_by)

### 4.3 billing
- Invoice(id, student_id, period(YYYY-MM), amount, due_date, status(PAID/UNPAID/PARTIAL), created_at)
- Payment(id, invoice_id, paid_amount, method(CASH/CARD/TRANSFER/ONLINE), paid_at, note)
- ChargeItem(id, invoice_id, type(TUITION/BOOK/etc), amount, memo)

### 4.4 schedule
- CalendarEvent(id, type(CLASS/MAKEUP/HOLIDAY/SPECIAL), title, start_at, end_at, class_id?, teacher_id?, location, description)
- MakeupClass(id, original_session_id, makeup_event_id, reason, created_by)
- HolidayRange(id, title, start_date, end_date, memo)

### 4.5 notifications
- NotificationTemplate(id, channel(SMS/KAKAO/EMAIL/APP), code, title, body, variables_json, is_active)
- NotificationJob(id, template_id, channel, target_type(STUDENT/PARENT/TEACHER), target_id, payload_json, scheduled_at, status, retries)
- NotificationLog(id, job_id, sent_at, provider_response, is_success, error_message)

### 4.6 academics
- Exam(id, name, subject, date, max_score, class_id?, memo)
- Score(id, exam_id, student_id, score, grade, note)
- LearningGoal(id, student_id, subject, start_date, end_date, target_score, progress_percent)
- ReportCard(id, student_id, period, generated_at, file_path, created_by)

### 4.7 materials
- Book(id, title, publisher, price, isbn, is_active)
- InventoryTxn(id, book_id, type(IN/OUT/ADJUST), qty, unit_cost, occurred_at, memo)
- StudentBookPurchase(id, student_id, book_id, qty, amount, invoice_id?, purchased_at, status)

### 4.8 crm
- Lead(id, name, phone, source, status(NEW/CONTACTED/VISITED/ENROLLED/LOST), memo, created_at)
- Campaign(id, name, start_date, end_date, budget, memo)
- Referral(id, referrer_student_id?, referrer_name, referred_student_name, reward_type, reward_status)
- ReEnrollTarget(id, student_id, due_period, status, last_contacted_at, memo)

### 4.9 communication
- ClassFeedback(id, class_id, session_id?, student_id?, teacher_id, content, created_at, shared_to_parent)
- WeeklyReport(id, student_id, week_start, summary, homework, teacher_comment, sent_at?)
- (선택)ChatRoom(id, parent_user_id, teacher_user_id, created_at)
- (선택)ChatMessage(id, room_id, sender_user_id, message, created_at, read_at?)

---

## 5. 화면/기능 명세 (MVP 기준)

### 5.1 공통
- 로그인/로그아웃
- 권한별 메뉴 노출
- 검색/필터(학생명, 반, 기간 등)
- Excel 내보내기 버튼(권한 제한)

### 5.2 학생/반
- 학생 목록: 검색/필터/등록/수정
- 학생 상세: 출결 요약, 수납 현황, 성적 추이, 상담일지, 교재 구매
- 반(클래스) 관리: 정원/담당강사/수업시간/수강생

### 5.3 출결(📱 QR 포함)
- 출결 세션 생성(수업일자 기준 자동 생성 가능)
- QR 생성 화면(유효시간/세션 연결)
- QR 스캔 화면(모바일 웹 고려)
- 출결 결과 입력/수정(결석/지각/메모)
- 출결 알림 자동 발송(결석 시 보호자)

### 5.4 수납/미납
- 청구서(Invoice) 생성(월/기간별)
- 납부 처리(부분 납부 포함)
- 미납 리스트 + 마감 알림 발송
- (선택) 온라인 결제 연동

### 5.5 일정/캘린더
- 월간 캘린더(전체/반/강사 필터)
- 보강 등록(원수업 ↔ 보강 일정 연결)
- 휴원 기간 설정(캘린더에 자동 반영)
- 특강/캠프 등록

### 5.6 알림/노티피케이션
- 템플릿 관리(변수: 학생명, 반명, 금액, 마감일 등)
- 즉시 발송 화면(대상 선택)
- 자동 트리거
  - 미납: D-3 / D-1 / 당일
  - 결석: 출결 마감 후 즉시
  - 상담: 1일 전
  - 일정 변경: 변경 시 즉시
- 발송 로그/실패 재시도

### 5.7 성적/학습
- 시험 등록(과목/만점/날짜)
- 성적 입력(엑셀 업로드는 2차)
- 학생별 과목 그래프(추이)
- 성적표 PDF 발급(기록 남김)
- 목표 설정/달성률

### 5.8 학부모 포털
- 학부모 로그인
- 자녀 선택 → 출결/성적/수납 조회
- (선택) 메시지/문의
- (선택) 온라인 결제

### 5.9 대시보드/리포트
- 출석률: 월/반/강사별
- 매출: 월별, 미수금
- 이탈률(퇴원/중단) 분석
- 강사별 수업 통계
- 수익성: 반/과목별(수입-비용, 비용은 추후 확장)

### 5.10 교재/CRM/커뮤니케이션
- 교재 재고/입출고
- 학생별 교재비 청구 자동 생성
- 대기자/리드 관리 + 연락 기록
- 추천인/리워드(단순 포인트/쿠폰 형태로 시작)
- 수업 피드백/주간·월간 보고서 발송

---

## 6. API/URL 설계(예시)

> 템플릿 기반 SSR + 필요 부분만 JSON API 권장

- /students/ (목록)
- /students/<id>/ (상세)
- /attendance/sessions/ (세션 목록)
- /attendance/sessions/<id>/qr/ (QR 생성)
- /attendance/scan/ (QR 스캔 페이지)
- /billing/invoices/ (청구서 목록)
- /billing/invoices/<id>/pay/ (납부 처리)
- /schedule/calendar/ (캘린더)
- /notifications/send/ (즉시 발송)
- /academics/exams/ (시험)
- /academics/students/<id>/ (성적/목표)
- /parent/ (학부모 홈)
- /reports/dashboard/ (대시보드)
- /export/excel/<resource>/ (엑셀 내보내기 엔드포인트)

---

## 7. 배치/백그라운드 작업 (Celery 권장)

- 미납 알림 스케줄러(매일 09:00)
- 상담 리마인더(매일 09:00)
- 주간/월간 보고서 자동 생성(주 1회/월 1회)
- PDF 성적표 생성(요청 시 비동기로 생성 가능)
- 리포트 집계(새벽 배치로 캐싱)

---

## 8. 로깅/감사/보안

- 개인정보 최소 수집(필요 필드만)
- 중요 이벤트 로깅
  - 출결 수정/수납 처리/권한 변경/알림 발송
- 비밀번호 정책/세션 만료/CSRF 기본 적용
- 학부모 포털 접근 범위 검증(서버 측 필수)

---

## 9. 도커/환경 구성(권장)

- services:
  - web (Django)
  - db (PostgreSQL)
  - redis (Celery/Channels 사용 시)
  - worker (Celery worker)
  - beat (Celery beat)

- 환경변수 예시
  - DATABASE_URL
  - SECRET_KEY
  - DEBUG
  - ALLOWED_HOSTS
  - REDIS_URL
  - NOTIFY_PROVIDER_KEY (SMS/카카오 등)
  - TIME_ZONE=Asia/Seoul

---

## 10. 개발 우선순위(로드맵)

### Phase 1 (MVP 운영 가능)
1) 학생/반/권한
2) 출결 + QR
3) 수납/미납
4) 캘린더(수업 일정)
5) 엑셀 내보내기
6) 기본 대시보드(출석률/매출)
7) 알림(즉시 발송 + 미납/결석 자동)

### Phase 2 (학부모 체감 상승)
8) 학부모 포털(출결/수납 조회)
9) 성적 입력 + 추이 그래프
10) 성적표(PDF)
11) 주간/월간 보고서

### Phase 3 (운영 최적화)
12) 고급 리포트(이탈률/강사 통계/수익성)
13) 교재/교재비 자동화
14) CRM(대기자/추천인/재등록)

### Phase 4 (차별화/고난이도)
15) 1:1 실시간 채팅(Channels)
16) 온라인 결제 정식 연동

---

## 11. 리스크/주의사항

- 알림 발송은 **법적 수신동의/야간 발송 제한** 등 정책 확인 필요
- QR 출석은 토큰 유출/재사용 방지(만료/1회성/세션 검증)
- 학부모 포털은 권한 버그가 치명적 → 테스트/검증 강화
- 리포트/집계는 데이터가 커지면 느려짐 → 집계 테이블/캐싱 고려

---

## 12. 산출물

- 계획서.md (본 문서)
- ERD(초안) 이미지 또는 mermaid 다이어그램(추후)
- 화면 설계(와이어프레임) (추후)
- API 명세서(추후)
- 테스트 체크리스트(추후)

---

끝.
